{% extends 'includes/base.html' %}
{% load static %}
{% block content %}
{% include 'includes/messages.html' %}
<div class="row">
	<div class="col-sm-12">
	   <div class="card">
		  <div class="card-body">
			<form method="post" action="{% url 'change_password' %}">
				{% csrf_token %}
				<div class="col-12">
					<div class="text-center flex-grow-1">
						<h1 class="h3 mb-0 text-gray-800"><span>Change Password</span></h1>
					</div>
				</div>
				<div class="col-sm-11">
					<div class="form-group">
						<label>Current Password</label>
						<input type="password" class="form-control" name="current_password" id="current_password" placeholder="Enter your current password" required>
					</div>
				</div>
				<div class="col-sm-11">
					<div class="form-group">
						<label>New Password</label>
						<input type="password" class="form-control" name="new_password" id="new_password" placeholder="Enter new password" required>
					</div>
				</div>
				<div class="col-sm-11">
					<div class="form-group">
						<label>Repeat New Password</label>
						<input type="password" class="form-control" name="repeat_new_password" id="repeat_new_password" placeholder="Repeat new password" required>
						<div id="password_error" style="color: red; display: none;">Passwords do not match.</div>
						<div id="compliance_messages" style="color: red; display: none;"></div>
					</div>
				</div>
				<div class="col-sm-11">
					<div class="form-group">
						<label>Password Requirements:</label>
						<ul>
							<li>At least 8 characters</li>
							<li>At least one capital letter</li>
							<li>At least one number</li>
							<li>At least one special character (e.g. !@#$%^&*)</li>
						</ul>
					</div>
				</div>
				<div class="col-12">
					<button type="submit" class="btn btn-primary">Change Password</button>
				</div>
			</form>
		  </div>
	   </div>
	</div>
 </div>
<script>
   document.addEventListener('DOMContentLoaded', function() {
	   const newPasswordInput = document.getElementById('new_password');
	   const repeatNewPasswordInput = document.getElementById('repeat_new_password');
	   const errorMessage = document.getElementById('password_error');
	   const complianceMessages = document.getElementById('compliance_messages');
	   const submitButton = document.querySelector('button[type="submit"]');

	   submitButton.disabled = true;

	   function validatePasswords() {
		   const password = newPasswordInput.value;
		   const repeatPassword = repeatNewPasswordInput.value;

		   // Check if passwords match
		   if (password !== repeatPassword) {
			   errorMessage.style.display = 'block';
		   } else {
			   errorMessage.style.display = 'none';
		   }

		   // Check password compliance
		   const complianceErrors = [];
		   if (!isPasswordValid(password)) {
			   if (password.length < 8) {
				   complianceErrors.push("Password must be at least 8 characters long.");
			   }
			   if (!/[A-Z]/.test(password)) {
				   complianceErrors.push("Password must contain at least one capital letter.");
			   }
			   if (!/[0-9]/.test(password)) {
				   complianceErrors.push("Password must contain at least one number.");
			   }
			   if (!/[!@#$%^&*(),.?\":{}|<>]/.test(password)) {
				   complianceErrors.push("Password must contain at least one special character.");
			   }
		   }

		   // Display compliance messages
		   if (complianceErrors.length > 0) {
			   complianceMessages.innerHTML = complianceErrors.join('<br>');
			   complianceMessages.style.display = 'block';
			   submitButton.disabled = true;
		   } else {
			   complianceMessages.style.display = 'none';
			   submitButton.disabled = password === repeatPassword ? false : true;
		   }
	   }

	   function isPasswordValid(password) {
		   return password.length >= 8 && /[A-Z]/.test(password) && /[0-9]/.test(password) && /[!@#$%^&*(),.?\":{}|<>]/.test(password);
	   }

	   newPasswordInput.addEventListener('input', validatePasswords);
	   repeatNewPasswordInput.addEventListener('input', validatePasswords);
   });
</script>




