{% extends "includes/base.html" %}
{% block content %}
	{% include 'includes/messages.html' %}
	<div class="card shadow mb-4">
		<div class="card-body">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<form id="eventFilterForm" method="get" class="d-flex align-items-center" action="">
					<label for="eventSelect" class="mr-3 mb-0 font-weight-bold">Attendees</label>
					<select id="eventSelect" name="event" class="form-control mr-3">
						<option value="">-- Select Event --</option>
						{% for ev in events %}
							<option value="{{ ev.id }}" {% if event and ev.id == event.id %}selected{% endif %}>
								{% if ev.title %}{{ ev.title }}{% else %}Event {{ ev.id }}{% endif %}
							</option>
						{% endfor %}
					</select>
				</form>
				<script>
				// auto-submit when event selection changes
				document.addEventListener('DOMContentLoaded', function(){
					const sel = document.getElementById('eventSelect');
					if(sel){ sel.addEventListener('change', function(){ document.getElementById('eventFilterForm').submit(); }); }
				});
				</script>
			</div>

			<div class="table-responsive">
				<table class="table table-bordered table-striped" id="attendeesTable">
					<thead>
						<tr>
							<th>First Name</th>
							<th>Last Name</th>
							<th>Email</th>
							<th>Organization</th>
						</tr>
					</thead>
					<tbody>
						{% for a in attendees %}
							<tr>
								<td>{{ a.first_name }}</td>
								<td>{{ a.last_name }}</td>
								<td>{{ a.email }}</td>
								<td>{{ a.organization }}</td>
							</tr>
						{% empty %}
							<tr>
								<td colspan="4" class="text-center">No attendees found.</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Initialize DataTable for attendees (search + pagination)
			try {
				$('#attendeesTable').DataTable({
					"order": [[ 0, "asc" ]],
					"paging": true,
					"searching": true,
					"lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
					"columnDefs": [ { "orderable": true, "targets": [0,1,2,3] } ]
				});
			} catch (e) {
				console.warn('DataTable init failed:', e);
			}
		});
	</script>
	{% endblock %}
